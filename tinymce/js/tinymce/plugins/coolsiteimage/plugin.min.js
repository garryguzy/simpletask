tinymce.PluginManager.add("coolsiteimage",function(e){function t(t){return function(){var n=e.settings.image_list;"string"==typeof n?tinymce.util.XHR.send({url:n,success:function(e){t(tinymce.util.JSON.parse(e))}}):t(n)}}function n(t){function n(){var e=[{text:"None",value:""}];return tinymce.each(t,function(t){e.push({text:t.text||t.title,value:t.value||t.url,menu:t.menu})}),e}function r(t){function n(n){function r(){n.onload=n.onerror=null,e.selection.select(n),e.nodeChanged()}n.onload=function(){t.width||t.height||c.setAttribs(n,{width:n.clientWidth,height:n.clientHeight}),r()},n.onerror=r}d?c.setAttribs(d,t):(t.id="__mcenew",e.insertContent(c.createHTML("img",t)),d=c.get("__mcenew"),c.setAttrib(d,"id",null)),n(d)}var i,o,a,s,l,c=e.dom,d=e.selection.getNode();a=c.getAttrib(d,"width"),s=c.getAttrib(d,"height"),d.nodeName!="IMG"||d.getAttribute("data-mce-object")?d=null:o={src:c.getAttrib(d,"src"),alt:c.getAttrib(d,"alt"),width:a,height:s},t&&(l={name:"target",type:"listbox",label:"Image list",values:n(),onselect:function(e){var t=i.find("#alt");(!t.value()||e.lastControl&&t.value()==e.lastControl.text())&&t.value(e.control.text()),i.find("#src").value(e.control.value())}}),LIST.material.insert=r,LIST.material.open("Image")}e.addButton("coolsiteimage",{icon:"image",tooltip:"Insert/edit image",onclick:t(n),stateSelector:"img:not([data-mce-object])"}),e.addMenuItem("coolsiteimage",{icon:"image",text:"Insert image",onclick:t(n),context:"insert",prependToContext:!0})});