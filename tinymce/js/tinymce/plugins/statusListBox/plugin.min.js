var StatusNode=null,getStatusType=function(e){return e?(" "+e.className+" ").replace(/[\n\t]/g," ").indexOf(" warning ")>-1?"warning":(" "+e.className+" ").replace(/[\n\t]/g," ").indexOf(" doubt ")>-1?"doubt":(" "+e.className+" ").replace(/[\n\t]/g," ").indexOf(" info ")>-1?"info":(" "+e.className+" ").replace(/[\n\t]/g," ").indexOf(" error ")>-1?"error":(" "+e.className+" ").replace(/[\n\t]/g," ").indexOf(" success ")>-1?"success":void 0:"clear"};tinymce.PluginManager.add("statusListBox",function(e){e.addCommand("statuschange",function(t,a){e.formatter.register("status",{block:"div",attributes:{"class":"message-box status %value"},wrapper:1}),e.formatter.register("changestatus",{block:"div",attributes:{"class":"message-box status %value"},wrapper:0});var o=tinymce.activeEditor.selection.getBookmark(),n=getStatusType(StatusNode);if("cancel"==a&&(a="clear"==n?"warning":n),n==a){if("clear"==n)return;e.formatter.remove("changestatus",{value:n,wrapper:1},StatusNode)}else"clear"==a&&StatusNode?e.formatter.remove("changestatus",{value:n,wrapper:1},StatusNode):!StatusNode&&a&&"clear"!=a?(StatusNode=tinymce.activeEditor.selection.getNode(),e.formatter.apply("status",{value:a,wrapper:1}),$("<p><br></p>").insertAfter(StatusNode.parentNode)):StatusNode&&a&&e.formatter.apply("changestatus",{value:a,wrapper:0},StatusNode);tinymce.activeEditor.selection.moveToBookmark(o)});var t,a=function(t){var a=null;(" "+e.selection.getNode().className+" ").replace(/[\n\t]/g," ").indexOf(" status ")>-1?a=ed.selection.getNode():(a=e.dom.getParent(e.selection.getNode(),"div"),a&&((" "+a.className+" ").replace(/[\n\t]/g," ").indexOf(" status ")>-1||(a=null)));var o=getStatusType(a);StatusNode=a,t&&t.control.items().each(function(e){e.active(e.settings.data===o)})};t=[{text:"无强调",data:"clear"},{text:"Warning",data:"warning"},{text:"Doubt",data:"doubt"},{text:"Info",data:"info"},{text:"Error",data:"error"},{text:"Success",data:"success"}],e.addButton("statusListBox",{text:"强调",type:"splitbutton",tooltip:"设置强调样式",menu:t,onshow:a,onselect:function(t){e.execCommand("statuschange",!1,t.control.settings.data)},onclick:function(){a(),e.execCommand("statuschange",!1,"cancel")}})});