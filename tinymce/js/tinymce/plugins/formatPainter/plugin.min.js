var painterswitch=!1,painterformat=null,currentFormatItem=null,painterstyle=null;tinymce.PluginManager.add("formatPainter",function(e){function t(){return tinymce.grep(e.selection.getSelectedBlocks(),function(e){return _.include(["P","UL","LI","OL"],e.nodeName)})}e.addCommand("formatpainter",function(t,n){var r=(e.selection,e.dom),o=r.getParent(e.selection.getStart(),"P,OL,UL"),i=tinymce.activeEditor.selection.getBookmark();if(o)if(o.nodeName==n){var a=[];tinymce.grep(e.selection.getSelectedBlocks(),function(t){t.nodeName=="LI"?a.push(e.dom.getParent(t,n)):a.push(t)}),painterstyle&&tinymce.grep(a,function(t){e.dom.setAttrib(t,"style",painterstyle)})}else{switch(n){case"UL":e.execCommand("InsertUnorderedList");break;case"OL":e.execCommand("InsertOrderedList");break;case"P":e.execCommand(o.nodeName=="UL"?"InsertUnorderedList":"InsertOrderedList")}var a=[];tinymce.grep(e.selection.getSelectedBlocks(),function(t){t.nodeName=="LI"?a.push(e.dom.getParent(t,n)):a.push(t)}),painterstyle&&tinymce.grep(a,function(t){e.dom.setAttrib(t,"style",painterstyle)})}else{switch(n){case"UL":e.execCommand("InsertUnorderedList");break;case"OL":e.execCommand("InsertOrderedList")}var a=[];tinymce.grep(e.selection.getSelectedBlocks(),function(t){t.nodeName=="LI"?a.push(e.dom.getParent(t,n)):a.push(t)}),painterstyle&&tinymce.grep(a,function(t){e.dom.setAttrib(t,"style",painterstyle)})}tinymce.activeEditor.selection.moveToBookmark(i)});var n=function(){var n=t();item=n.length>0?n[0]:null,item&&(item.nodeName=="LI"||item.nodeName=="OI")&&(item=e.dom.getParent(item,"OL,UL")),currentFormatItem=item},r=function(t){console.log(t.element),console.log(e.selection.getSelectedBlocks()),e.execCommand("formatpainter",!1,painterformat)},o=function(){$("article.mce-edit-focus").css("cursor","pointer"),e.on("NodeChange",r)},i=function(){$("article.mce-edit-focus").css("cursor","text"),painterswitch=!1,painterformat=null,e.off("NodeChange",r),$(document).off("keyup")};e.addButton("formatPainter",{text:null,icon:"copy",tooltip:"复制样式",onclick:function(e){n(e),painterswitch&&painterformat?(e.control.active(!1),i()):currentFormatItem&&(painterswitch=!0,e.control.active(!0),painterformat=currentFormatItem.nodeName,painterstyle=$(currentFormatItem).attr("style")||null,o(),$(document).on("keyup",function(){e.control.active(!1),i()}))}})});