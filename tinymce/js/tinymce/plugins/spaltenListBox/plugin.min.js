var SpaltenNode=null,getSpaltenType=function(e){return e?e.children[0].className=="span6"?"cols_2":e.children[0].className=="span4"&&e.children[1].className=="span4"?"cols_3":e.children[0].className=="span4"&&e.children[1].className=="span8"?"cols_1_2":e.children[0].className=="span8"&&e.children[1].className=="span4"?"cols_2_1":void 0:"cols_1"},setSpaltenType=function(e,t){if(e!=t){if("cols_1"==t)switch(e){case"cols_1_2":case"cols_2_1":case"cols_2":$(SpaltenNode.children[0]).children().unwrap(),$(SpaltenNode.children[1]).children().unwrap(),tinymce.activeEditor.formatter.toggle("spalten",{},SpaltenNode);break;case"cols_3":$(SpaltenNode.children[0]).children().unwrap(),$(SpaltenNode.children[1]).children().unwrap(),$(SpaltenNode.children[2]).children().unwrap(),tinymce.activeEditor.formatter.toggle("spalten",{},SpaltenNode)}if("cols_2"==t)switch(e){case"cols_1":tinymce.activeEditor.formatter.apply("spalten",{}),$SpaltenNode=$(SpaltenNode).parent(),$SpaltenNode.wrapInner('<span class="span6"></span>'),$SpaltenNode.append('<span class="span6"><p><br></p></span>'),$SpaltenNode.parent().append("<p><br></p>");break;case"cols_1_2":case"cols_2_1":SpaltenNode.children[0].className="span6",SpaltenNode.children[1].className="span6";break;case"cols_3":SpaltenNode.children[0].className="span6",SpaltenNode.children[1].className="span6",SpaltenNode.children[1].innerHTML=SpaltenNode.children[1].innerHTML+SpaltenNode.children[2].innerHTML,$(SpaltenNode.children[2]).remove()}if("cols_3"==t)switch(e){case"cols_1":tinymce.activeEditor.formatter.apply("spalten",{}),$SpaltenNode=$(SpaltenNode).parent(),$SpaltenNode.wrapInner('<span class="span4"></span>'),$SpaltenNode.append('<span class="span4"><p><br></p></span>'),$SpaltenNode.append('<span class="span4"><p><br></p></span>'),$SpaltenNode.parent().append("<p><br></p>");break;case"cols_1_2":case"cols_2_1":case"cols_2":SpaltenNode.children[0].className="span4",SpaltenNode.children[1].className="span4",$(SpaltenNode).append('<span class="span4"><p><br></p></span>')}if("cols_1_2"==t)switch(e){case"cols_1":tinymce.activeEditor.formatter.apply("spalten",{}),$SpaltenNode=$(SpaltenNode).parent(),$SpaltenNode.wrapInner('<span class="span4"></span>'),$SpaltenNode.append('<span class="span8"><p><br></p></span>'),$SpaltenNode.parent().append("<p><br></p>");break;case"cols_2":case"cols_2_1":SpaltenNode.children[0].className="span4",SpaltenNode.children[1].className="span8";break;case"cols_3":SpaltenNode.children[0].className="span4",SpaltenNode.children[1].className="span8",SpaltenNode.children[1].innerHTML=SpaltenNode.children[1].innerHTML+SpaltenNode.children[2].innerHTML,$(SpaltenNode.children[2]).remove()}if("cols_2_1"==t)switch(e){case"cols_1":tinymce.activeEditor.formatter.apply("spalten",{}),$SpaltenNode=$(SpaltenNode).parent(),$SpaltenNode.wrapInner('<span class="span8"></span>'),$SpaltenNode.append('<span class="span4"><p><br></p></span>'),$SpaltenNode.parent().append("<p><br></p>");break;case"cols_2":case"cols_1_2":SpaltenNode.children[0].className="span8",SpaltenNode.children[1].className="span4";break;case"cols_3":SpaltenNode.children[0].className="span8",SpaltenNode.children[1].className="span4",SpaltenNode.children[1].innerHTML=SpaltenNode.children[1].innerHTML+SpaltenNode.children[2].innerHTML,$(SpaltenNode.children[2]).remove()}}};tinymce.PluginManager.add("spaltenListBox",function(e){e.addCommand("spaltenchange",function(t,n){tinymce.activeEditor.formatter.register("spalten",{block:"div",attributes:{"class":"row-fluid"},wrapper:1});var r=getSpaltenType(SpaltenNode),i=n;SpaltenNode||(SpaltenNode=e.selection.getNode());var o=tinymce.activeEditor.selection.getBookmark();setSpaltenType(r,i),tinymce.activeEditor.selection.moveToBookmark(o)});var t,n=function(t){var n=null;n=e.selection.getNode().className=="row-fluid"?e.selection.getNode():e.dom.getParent(e.selection.getNode(),"div"),n&&n.className!="row-fluid"&&(n=null);var r=getSpaltenType(n);SpaltenNode=n,t.control.items().each(function(e){e.active(e.settings.data===r)})};t=[{text:"一栏",data:"cols_1"},{text:"两栏(1:1)",data:"cols_2"},{text:"两栏(1:2)",data:"cols_1_2"},{text:"两栏(2:1)",data:"cols_2_1"},{text:"三栏",data:"cols_3"}],e.addButton("spaltenListBox",{text:"分栏",type:"splitbutton",icon:null,menu:t,onshow:n,onselect:function(t){console.log(t.control.settings.data),e.execCommand("spaltenchange",!1,t.control.settings.data)},onclick:function(){console.log("click")}})});