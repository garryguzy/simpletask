tinymce.PluginManager.add("custom_autosave",function(e){function t(e,t){var n={s:1e3,m:6e4};return e=/^(\d+)([ms]?)$/.exec(""+(e||t)),(e[2]?n[e[2]]:1)*parseInt(e,10)}function n(){l&&e.isDirty()&&(c.setItem(s+"autosave.draft",e.getContent({format:"raw",no_events:!0})),c.setItem(s+"autosave.time",(new Date).getTime()),e.fire("StoreDraft"))}function o(){if(!l){if(e.on("change setcontent paste keyup",function(){global.change=!0}),!global)return;if(global.saveInterval)return;global.saveInterval=setInterval(function(){global&&global.change&&global.autosave&&global.autosave(function(){})},i.autosave_interval),l=!0}}function a(){console.log("editor init"),e.focus(),o()}function r(){var e;return tinymce.each(tinymce.editors,function(t){t.plugins.autosave,!e&&t.isDirty()&&t.getParam("autosave_ask_before_unload",!0)&&(e=t.translate("You have unsaved changes are you sure you want to navigate away?"))}),global.change?e:void 0}var l,i=e.settings,c=tinymce.util.LocalStorage,s=e.id;i.autosave_interval=t(i.autosave_interval,"180s"),i.autosave_retention=t(i.autosave_retention,"20m"),e.on("init",a),this.storeDraft=n,window.onbeforeunload=r});